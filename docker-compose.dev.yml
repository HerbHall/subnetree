# SubNetree - Development Docker Compose
#
# Builds from local source instead of pulling from GHCR.
#
# Usage:
#   docker compose -f docker-compose.dev.yml up --build
#
# This file is for contributors building SubNetree from source.
# Regular users should use docker-compose.yml instead.

services:
  subnetree:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        VERSION: ${VERSION:-dev}
        COMMIT: ${COMMIT:-unknown}
        BUILD_TIME: ${BUILD_TIME:-unknown}
    container_name: subnetree-dev
    restart: unless-stopped
    ports:
      - "8080:8080"
      - "9090:9090"
    volumes:
      - subnetree-dev-data:/data
    environment:
      - NV_DATABASE_DSN=/data/subnetree.db
      - NV_LOG_LEVEL=debug
      - NV_DEV_MODE=true
    cap_add:
      - NET_RAW
      - NET_ADMIN
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/healthz"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s

volumes:
  subnetree-dev-data:
